# 답변 서비스 SRS (Software Requirements Specification)

## 1. 소개
### 1-1. 목적
본 문서는 무물보의 답변 서비스에 대한 기능적 및 비기능적 요구사항을 정의합니다.

답변 서비스는 사용자 질문에 대해 답변을 등록하고 관리하며, 질문과 답변 간의 연관성을 제공합니다.

본 서비스는 마이크로서비스 아키텍처로 설계되며, 다른 서비스와 독립적으로 배포 및 운영됩니다.

### 1-2. 범위
- 사용자 인증을 통해 답변 작성 기능 제공
- 질문에 대한 다수의 답변 등록 및 조회
- 자신의 답변에 대한 수정 및 삭제
- 답변 채택 기능
- 채택 여부에 따른 상태 관리
- 모든 사용자에 대한 답변 읽기 권한

### 1-3. 용어 정의
- 답변 서비스 : 무물보에 올라온 질문에 대한 답변 처리를 하는 서비스
- 채택 : 질문자가 특정 답변을 최종 답변으로 선정
- 미채택 : 채택되지 않은 상태의 답변
- 인증 사용자 : 소셜 로그인 후 인증을 완료한 사용자
- API GateWay : 모든 외부 클라이언트 요청을 처리하는 서비스

  
## 2. 시스템 개요
### 2-1. 시스템 구성
- 프론트엔드 : React 기반 SPA
- API Gateway : Spring Cloud Gateway
- 답변 서비스 : Spring Boot 기반 마이크로서비스
- 인증/회원 서비스 : 별도의 인증 마이크로서비스에서 소셜 로그인 및 인증/탈퇴 관리

### 2-2. 서비스 흐름도
Client (React) -> API Gateway (Spring Cloud Gateway) -> Answer Service (Spring Boot)


## 3. 기능 요구사항
### 3-1. 회원 인증 관련
ID|기능|설명|
|------|---|---|
|F-01|회원 가입|소셜 로그인 연동을 통해 신규 회원 등록|
|F-02|로그인|소셜 인증 후 서비스 접근 토큰 발급|
|F-03|회원 탈퇴|회원 정보 및 작성한 답변 처리|

### 3-2. 답변 기능
ID|기능|설명|
|------|---|---|
|F-10|답변 조회|질문 ID로 등록된 모든 답변을 조회, 모든 사용자 접근 가능|
|F-11|답변 작성|인증된 사용자만 가능|
|F-12|답변 수정|작성자 본인만 수정 가능|
|F-13|답변 삭제|작성자 본인만 삭제 가능|
|F-14|답변 채택|질문 작성자가 원하는 답변을 채택 가능. 하나의 질문에 하나의 답변만 채택 가능|
|F-15|답변 상태|각 답변은 채택, 미채택 상태를 가짐|

### 3-3. UI 요구사항 (질문 상세 화면 기준)
ID|기능|설명|
|------|---|---|
|F-20|답변 표시|질문 상세 화면에서 관련 답변 목록 표시|
|F-21|버튼 활성화|로그인한 사용자의 답변일 경우만 '수정', '삭제' 버튼 활성화|
|F-22|채택 표시|질문 작성자가 채택한 답변의 경우 '채택' 표시|

## 4. 비기능 요구사항
ID|항목|설명|
|------|---|---|
|NF-01|인증|모든 쓰기 작업은 JWT 인증 필요|
|NF-02|API 보안|API Gateway에서 인증, 요청 라우팅 수행|
|NF-03|RESTful API|모든 API는 REST API 형식을 따름|
|NF-04|확장성|마이크로서비스 아키텍처로 구성되어 독립적인 확장 가능|
|NF-05|응답 시간|95% 요청은 1초 이내로 응답 완료|
|NF-06|가용성|서비스는 99.9% 이상의 가용성 목표|

## 5. 시스템 아키텍처

답변 서비스 중심으로
```
                 +---------------------+
                 |     Client (Web)    |
                 |   React (SPA) App   |
                 +---------------------+
                           |
                           v
               +------------------------+
               |  Spring Cloud Gateway  |
               |  (API Gateway Layer)   |
               +------------------------+
                           |
        +------------------+------------------------+
        |                  |                        |
        v                  v                        v
+----------------+  +----------------+      +----------------+
|  Auth Service  |  | Question SVC   |      |  Answer SVC    |
| (OAuth Login,  |  | (질문 등록,조회)  |      | (답변 CRUD,    |
| JWT 발급, etc)  |  +----------------+      |  채택 로직)     |
+----------------+                          +----------------+
        |                                             |
        |                                             |
        |                           +-----------------v----------------+
        |                           |         Answer Database          |
        |                           |   (답변 테이블, 채택 상태 등)          |
        |                           +----------------------------------+
        |
+--------------------+
| User DB (회원 정보)   |
+--------------------+

```
### 인증 흐름
1. 사용자는 React 앱에서 소셜 로그인 요청
2. Auth Service가 OAuth 인증 -> JWT 발급
3. 클라이언트는 JWT를 Authorization 헤더에 담아 Gateway로 요청 전송
4. Gateway는 토큰 유효성 검사 후 각 마이크로서비스로 라우팅

## 6. 데이터 설계
### 6-1. 주요 Entity
Answer
필드명|타입|설명|
|------|---|---|
|id|Long|답변 ID|
|questionId|Long|관련 질문 ID|
|memberId|Long|작성자 회원 ID|
|content|String|답변 본문|
|status|Enum|ADOPTED / NOT_ADOPTED|
|createdAt|Timestamp|생성 일시|
|updateAt|Timestamp|수정 일시|

## 7. 유스케이스 정의
### UC-01. 답변 작성
항목|내용|
|------|---|
|유스케이스 ID|UC-01|
|유스케이스 명|답변 작성|
|액터|인증된 사용자|
|전제조건|사용자 로그인 완료(JWT 토큰 포함)|
|기본 흐름|1. 사용자가 질문 상세 화면에서 답변을 작성 2. API 요청을 통해 답변 등록 3. 답변 서비스에서 저장 후 응답 반환|
|예외 흐름|인증 토큰 없음 또는 만료 -> 401 오류 반환 / 입력값 유효성 오류 -> 400 오류 반환|
|결과|새로운 답변이 질문에 연결되어 등록됨|


### UC-02. 답변 수정
항목|내용|
|------|---|
|유스케이스 ID|UC-02|
|유스케이스 명|답변 수정|
|액터|인증된 사용자 (작성자 본인)|
|전제조건|작성자 본인이 로그인 상태여야 하며, 해당 답변의 작성자여야 함|
|기본 흐름|1. 사용자가 본인의 답변에서 수정 버튼 클릭 2. 수정되 내용을 입력 후 저장 3. API 호출을 통해 서버에 수정 요청 4. 서버에서 작성자 확인 후 답변 내용 수정|
|예외 흐름|작성자가 아닌 경우 -> 403 오류 반환 / 입력값 오류 -> 400 오류|
|결과|기존 답변의 내용이 새로운 내용으로 업데이트 됨|


### UC-03. 답변 삭제
항목|내용|
|------|---|
|유스케이스 ID|UC-03|
|유스케이스 명|답변 삭제|
|액터|인증된 사용자 (작성자 본인)|
|전제조건|작성자 본인이 로그인 상태여야 하며, 해당 답변의 작성자여야 함|
|기본 흐름|1. 사용자가 본인의 답변에서 삭제 버튼 클릭 2. 삭제 확인 후 API 요청 3. 서버에서 작성자 확인 후 답변 삭제|
|예외 흐름|작성자가 아닌 경우 -> 403 오류 반환|
|결과|해당 답변이 삭제됨 (Soft Delete 여부 확정 필요)|


### UC-04. 답변 목록 조회 (질문 상세 조회 시)
항목|내용|
|------|---|
|유스케이스 ID|UC-04|
|유스케이스 명|답변 목록 조회|
|액터|모든 사용자|
|전제조건|질문 상세 화면에 접근|
|기본 흐름|1. 사용자가 질문 리스트에서 질문 클릭 2. 프론트에서 질문 상세 및 답변 목록 API 호출 3. 서버에서 질문 ID에 해당하는 답변 목록 반환|
|예외 흐름|작성자가 아닌 경우 -> 403 오류 반환|
|결과|질문과 연결된 모든 답변이 리스트로 표시됨(채택 여부 표시 포함)|


### UC-05. 답변 채택
항목|내용|
|------|---|
|유스케이스 ID|UC-05|
|유스케이스 명|답변 채택|
|액터|질문 작성자|
|전제조건|질문을 등록한 사용자로 로그인되어 있어야 함|
|기본 흐름|1. 질문 작성자가 답변 리스트에서 '채택'버튼 클릭 2. 해당 답변의 상태를 '채택'으로 변경 3. 기존 채택 답변이 있다면 상태를 '미채택'으로 변경|
|예외 흐름|작성자가 아닌 경우 -> 403 오류 반환|
|결과|채택된 답변이 반영됨|

## 8. 시퀀스 다이어그램

### UC-01/02/03 : 답변 작성/수정/삭제
```
[사용자] → [React 프론트엔드] : 작성/수정/삭제 클릭
[React] → [API Gateway] : POST/PUT/DELETE /answers/{id}
[API Gateway] → [답변 서비스] : 해당 API 전달
[답변 서비스] → [DB] : INSERT / UPDATE / DELETE
[DB] → [답변 서비스] : 처리 완료
[답변 서비스] → [API Gateway] : 응답 반환
[API Gateway] → [React] : 결과 응답
[React] → [사용자] : UI 업데이트
```

### UC-04 : 답변 채택
```
[사용자(질문 작성자)] → [React] : 채택 버튼 클릭
[React] → [API Gateway] : PUT /answers/{answerId}/adopt
[API Gateway] → [답변 서비스] : 채택 처리
[답변 서비스] → [DB] : 기존 채택 해제, 새 답변 채택
[DB] → [답변 서비스] : 처리 완료
[답변 서비스] → [API Gateway] : 응답 반환
[API Gateway] → [React] : 채택 결과 응답
[React] → [사용자] : 채택 UI 반영
```


### UC-05 : 질문 상세 + 답변 목록 조회
```
[사용자] → [React] : 질문 목록에서 질문 클릭
[React] → [API Gateway] : GET /questions/{id}, GET /answers?questionId={id}
[API Gateway] → [질문 서비스], [답변 서비스] : 요청 분기
[각 서비스] → [DB] : 데이터 조회
[DB] → [각 서비스] : 결과 반환
[각 서비스] → [API Gateway] : 질문, 답변 데이터 전달
[API Gateway] → [React] : 병합 응답
[React] → [사용자] : 질문 + 답변 UI 렌더링
```


## 9. API 명세 요약
https://github.com/A-OverFlow/mmb-docs/blob/main/0_%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8_%EA%B4%80%EB%A6%AC/1_%EA%B0%9C%EB%B0%9C/API_Docs/ANSWER_REST_API_Docs.md
|HTTP Method|URL|비고|
|------|---|---|
|GET|https://mumulbo.com/api/v1/questions/{questionId}/answers|질문의 답변 전체 조회|
|GET|~~https://mumulbo.com/api/v1/answers/{answerId}~~|~~답변 단건 조회~~ 스펙 아웃|
|POST|https://mumulbo.com/api/v1/answers|답변 생성|
|PATCH|https://mumulbo.com/api/v1/answers/{answerId}|답변 수정
|DELETE|https://mumulbo.com/api/v1/answers/{answerId}|답변 삭제
|PATCH|https://mumulbo.com/api/v1/answers/{answerId}/accept|채택(NEXT)

## 10. 테스트

| TC ID  | 시나리오 명                        | 입력값 / 조건                              | 기대 결과                                      |
|--------|------------------------------------|---------------------------------------------|------------------------------------------------|
| TC-01 | 답변 작성 성공                    | 로그인 상태, 질문 ID, 유효한 내용         | 답변 생성, 상태: NOT_ADOPTED, 201 응답         |
| TC-02 | 답변 작성 실패 (비로그인)          | 인증 없음                                  | 401 Unauthorized                               |
| TC-03 | 답변 작성 실패 (빈 내용)           | 공백 내용                                  | 400 Bad Request                                |
| TC-04 | 답변 수정 성공                    | 작성자 본인, 유효한 수정 내용             | 답변 내용 수정됨, 200 OK                       |
| TC-05 | 답변 수정 실패 (다른 사용자)       | 작성자 아님                                | 403 Forbidden                                  |
| TC-06 | 답변 삭제 성공                    | 작성자 본인                                | 답변 삭제됨 (또는 isDeleted=true), 200 OK     |
| TC-07 | 답변 삭제 실패 (다른 사용자)       | 작성자 아님                                | 403 Forbidden                                  |
| TC-08 | 답변 채택 성공                    | 질문 작성자, 채택할 답변 ID               | 기존 채택 해제 후 새 답변 채택, 200 OK        |
| TC-09 | 답변 채택 실패 (다른 사용자)       | 질문 작성자 아님                           | 403 Forbidden                                  |
| TC-10 | 질문 상세 조회 시 답변 목록 표시   | 질문 ID=123                                | 해당 질문의 모든 답변 목록 반환, 채택 여부 포함 |
| TC-11 | 답변 목록에서 수정/삭제 버튼 보임  | 로그인 사용자 = 작성자                    | isOwner=true → 수정/삭제 버튼 노출            |
| TC-12 | 답변 목록에서 수정/삭제 버튼 숨김  | 로그인 사용자 ≠ 작성자                    | isOwner=false → 버튼 숨김                     |


## 11. 참고
협의 사항
1. DB 별개? 마이그레이션?
2. soft delete?
