# ê°œìš”

> ì„œë¹„ìŠ¤ë¥¼ MSA í™˜ê²½ì— ë°°í¬í•˜ê¸° ìœ„í•˜ì—¬ í•„ìš”í•œ êµ¬ì„±ë“¤ì„ ì„¤ëª…í•œë‹¤.

## ê°€ì´ë“œê°€ í•„ìš”í•œ ì´ìœ 

1. ë…ë¦½ì ì¸ ì„œë¹„ìŠ¤ ê°œë°œ ë° ë°°í¬ëŠ” MSAì˜ í•µì‹¬ì´ë‹¤
2. ì„œë¹„ìŠ¤ ê°œë°œìì™€ ë°°í¬ ë‹´ë‹¹ì ëª¨ë‘ í•´ë‹¹ ê³¼ì •ì„ ì´í•´í•˜ê³  ìˆì–´ì•¼ ì›í™œí•œ ë°°í¬ê°€ ê°€ëŠ¥í•˜ë‹¤
3. MSA í™˜ê²½ì— ì„œë¹„ìŠ¤ê°€ ìë™ìœ¼ë¡œ ë°°í¬ë  ë•Œ ê±°ì¹˜ëŠ” ê³¼ì •ì´ ë³µì¡í•˜ê¸° ë•Œë¬¸ì—
4. ëª¨ë“  ì„œë¹„ìŠ¤(í”„ë¡œì íŠ¸)ê°€ ì¼ê´€ëœ ë°°í¬ êµ¬ì„±ì„ ê°€ì§€ëŠ” ê²ƒì´ ì¢‹ë‹¤

# ì „ì²´ íë¦„

- GitHubì—ì„œ ë¸Œëœì¹˜ ìƒì„± (`feature/ê²Œì‹œíŒì‘ì„±`, ë“±)
- ê¸°ëŠ¥ ê°œë°œ í›„ í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±í•˜ì—¬ í…ŒìŠ¤íŠ¸
- í”„ë¡œì„¸ìŠ¤ë¡œ ì‹¤í–‰í•˜ì—¬ í…ŒìŠ¤íŠ¸
- `application.yml`ì€ í™˜ê²½ë³€ìˆ˜ ì£¼ì… ë°©ì‹ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±
    - ê¸°ë³¸ê°’ ë°˜ë“œì‹œ ì„¤ì •
    - `application.yml` íŒŒì¼ì€ í•˜ë‚˜ë§Œ ì¡´ì¬!
- `Dockerfile` ì‘ì„± (ë©€í‹°ìŠ¤í…Œì´ì§€ ë¹Œë“œ ì‚¬ìš©)
    - ë©€í‹° ìŠ¤í…Œì´ì§€ ë¹Œë“œ : ë¹Œë“œìš© ì´ë¯¸ì§€ì™€ ì‹¤í–‰ìš© ì´ë¯¸ì§€ë¥¼ ë¶„ë¦¬í•˜ì—¬, ìµœì¢… ì´ë¯¸ì§€ì— ë¶ˆí•„ìš”í•œ íŒŒì¼ì´ë‚˜ ë„êµ¬ê°€ í¬í•¨ë˜ì§€ ì•Šë„ë¡ ë§Œë“œëŠ” ê¸°ë²•
- `.dockerignore` ì¶”ê°€í•˜ì—¬ docker image ìµœì í™”
- `docker-compose.yml` ì‘ì„±
    - ê°œë°œ/ìš´ì˜ ì„œë²„ë¡œ ë³µì‚¬ë˜ì–´ ì‹¤í–‰ë  compose íŒŒì¼
    - ê°œë°œ/ìš´ì˜ ì„œë²„ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±
    - GHCR(GitHub Container Registry)ì— ì—…ë¡œë“œëœ(ë ) ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©
    - DB í•„ìš”í•  ê²½ìš° DB ì»¨í…Œì´ë„ˆ ì„¤ì •ë„ í•¨ê»˜
    - .env íŒŒì¼ë¡œ í™˜ê²½ë³€ìˆ˜ ì£¼ì…ë°›ì„ ìˆ˜ ìˆë„ë¡ ì‘ì„±
    - ì‚¬ì „ì— í˜‘ì˜ëœ networks ì„¤ì • í•„ìš”
- `docker-compose.override.yml` ì‘ì„±
    - compose íŒŒì¼ì„ ë®ì–´ì“°ëŠ” ë¡œì»¬ ì „ìš© ì„¤ì •
    - ê°œë°œ/ìš´ì˜ ì„œë²„ ê¸°ì¤€ ì„¤ì •ì€ ë¡œì»¬ì—ì„œ ë™ì‘í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— override ì„¤ì • í•„ìš”
- ì„œë¹„ìŠ¤ê°€ ë¡œì»¬ì—ì„œ ì»¨í…Œì´ë„ˆë¡œ ì‹¤í–‰ë  ìˆ˜ ìˆë„ë¡ `.env` íŒŒì¼ ì„¤ì •
    - .env íŒŒì¼ì€ docker compose up ëª…ë ¹ì´ ì‹¤í–‰ë  ë•Œ ìë™ìœ¼ë¡œ ì°¸ì¡°ë¨
    - .env íŒŒì¼ì€ í‚¤ë§Œ ì¡´ì¬í•˜ë©° ê°’ì€ ì„¤ì •ë˜ì–´ ìˆì§€ ì•ŠìŒ
    - ê°’ì„ ì„¤ì •í•´ì„œ ì‚¬ìš©í•˜ì§€ë§Œ ì»¤ë°‹í•´ì„œëŠ” ì•ˆë¨!
    - application.ymlì˜ ê¸°ë³¸ ê°’ì„ ì°¸ì¡°í•˜ì—¬ ì‘ì„±í•˜ë©´ ë™ì¼í•œ ë™ì‘ ë³´ì¥ë¨
- ì»¨í…Œì´ë„ˆ ì‹¤í–‰ì„ ìœ„í•œ networks ì„¤ì •
    - `docker network create backend-net` (ìµœì´ˆ 1íšŒ)
- `docker-compose up` ëª…ë ¹ìœ¼ë¡œ ë¡œì»¬ì—ì„œ ì»¨í…Œì´ë„ˆ ì‹¤í–‰
- ì»¨í…Œì´ë„ˆ í…ŒìŠ¤íŠ¸
    - `.env`ë¥¼ ì‚¬ìš©í•œ ì„¤ì • ì£¼ì…ì´ ì˜ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸
- í…ŒìŠ¤íŠ¸ ì™„ë£Œ
- `main` ë˜ëŠ” `develop` ë¸Œëœì¹˜ë¡œ Pull Request ìƒì„±
- PRì— ëŒ€í•œ Merge ìŠ¹ì¸ í›„ ë¸Œëœì¹˜ì— í•´ë‹¹í•˜ëŠ” GitHub Actions ìë™ ì‹¤í–‰
    - Docker ì´ë¯¸ì§€ ë¹Œë“œ ë° GHCRì— ì—…ë¡œë“œ
    - SSHë¡œ ê°œë°œ/ìš´ì˜ ì„œë²„ ì ‘ì† â†’ `.env` + Compose íŒŒì¼ ìƒì„±(ë³µì‚¬)
    - `docker compose up -d` ì‹¤í–‰
- ë°°í¬ ì™„ë£Œ

# ìƒì„¸ êµ¬ì¡° ì˜ˆì œ

## ë””ë ‰í† ë¦¬ êµ¬ì„±

```plaintext
myboard-backend/
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ .dockerignore
â”œâ”€â”€ docker-compose.yml             # ê°œë°œ/ìš´ì˜ ì„œë²„ìš© ì‹¤í–‰ íŒŒì¼
â”œâ”€â”€ docker-compose.override.yml    # ë¡œì»¬ ê°œë°œìš©ìœ¼ë¡œ ë®ì–´ì“°ê¸°
â”œâ”€â”€ .env                           # ë¡œì»¬ ê°œë°œ ì„¤ì • (ê°œë°œ/ìš´ì˜ ì„œë²„ëŠ” GitHub Secrets ì‚¬ìš©)
â”œâ”€â”€ src/
â”‚   â””â”€â”€ main/
â”‚       â””â”€â”€ resources/
â”‚           â””â”€â”€ application.yml     # í™˜ê²½ë³€ìˆ˜ ê¸°ë°˜ êµ¬ì„±
â””â”€â”€ .github/
    â””â”€â”€ workflows/
        â”œâ”€â”€ deploy-dev.yml         # ê°œë°œ ì„œë²„ìš© ìë™ ë°°í¬ ì„¤ì • íŒŒì¼
        â””â”€â”€ deploy-prod.yml        # ìš´ì˜ ì„œë²„ìš© ìë™ ë°°í¬ ì„¤ì • íŒŒì¼
```

## Dockerfile (ë©€í‹°ìŠ¤í…Œì´ì§€ ë¹Œë“œ ì ìš©)

```Dockerfile
# 1ë‹¨ê³„: Gradleë¡œ ë¹Œë“œ
FROM gradle:8.5-jdk17 AS builder

# ë¹Œë“œìš© ë””ë ‰í† ë¦¬ ì§€ì •
WORKDIR /app

# Gradle wrapper í¬í•¨ ì „ì²´ ë³µì‚¬
COPY . .

# í•„ìš”í•œ ì˜ì¡´ì„± ìºì‹±
RUN gradle clean bootJar --no-daemon

# 2ë‹¨ê³„: ì‹¤í–‰ìš© ê²½ëŸ‰ ì´ë¯¸ì§€
FROM eclipse-temurin:17-jdk-alpine

# ì•± ë””ë ‰í† ë¦¬ ìƒì„±
WORKDIR /app

# ë¹Œë“œëœ JAR ë³µì‚¬
COPY --from=builder /app/build/libs/*.jar app.jar

# í¬íŠ¸ ë…¸ì¶œ (ì„ íƒ)
EXPOSE 8080

# ì‹¤í–‰ ì»¤ë§¨ë“œ
ENTRYPOINT ["java", "-jar", "app.jar"]
```

## .dockerignore

```dockerignore
# ê¸°ë³¸ ë¶ˆí•„ìš” í•­ëª©
.git
.idea
*.iml
*.md
*.log
.env
.DS_Store

# Gradle ìºì‹œ, ë¹Œë“œ ì•„í‹°íŒ©íŠ¸
.gradle
build/
out/

# í…ŒìŠ¤íŠ¸ ì½”ë“œ ì œì™¸ (ì˜µì…˜)
src/test/

# ê¸°íƒ€
**/__pycache__/
**/.classpath
**/.project
**/.settings/
```

## src/main/resources/application.yml

```yaml
spring:
  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:mysql://localhost:3306/myboard}
    username: ${SPRING_DATASOURCE_USERNAME:myuser}
    password: ${SPRING_DATASOURCE_PASSWORD:mypassword}

server:
  port: ${SERVER_PORT:8080}

logging:
  level:
    root: ${LOG_LEVEL_ROOT:info}
    com.example.myboard: ${LOG_LEVEL_MYBOARD:debug}
```

### êµ¬ì„± ì„¤ëª…

í™˜ê²½ ë³€ìˆ˜ë¥¼ ì£¼ì… ë°›ê±°ë‚˜ ê¸°ë³¸ ì„¤ì •ì„ ì‚¬ìš©.

| í•­ëª©                                    | ì„¤ëª…                         |
|---------------------------------------|----------------------------|
| `SPRING_DATASOURCE_URL`               | DB ì—°ê²° URL (ê¸°ë³¸: ë¡œì»¬ MySQL)   |
| `SPRING_DATASOURCE_USERNAME`          | DB ì‚¬ìš©ìëª… (ê¸°ë³¸: `myuser`)     |
| `SPRING_DATASOURCE_PASSWORD`          | DB ë¹„ë°€ë²ˆí˜¸ (ê¸°ë³¸: `mypassword`) |
| `SERVER_PORT`                         | ì»¨í…Œì´ë„ˆ ë‚´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ í¬íŠ¸        |
| `LOG_LEVEL_ROOT`, `LOG_LEVEL_MYBOARD` | ë¡œê¹… ì„¤ì •ì„ ì™¸ë¶€ì—ì„œ ì¡°ì • ê°€ëŠ¥          |

### êµ¬ì„± íŠ¹ì§•

- **í™˜ê²½ ë³€ìˆ˜ë§Œ ì„¤ì •í•˜ë©´ profile ì—†ì´ í™˜ê²½ ë¶„ë¦¬ ê°€ëŠ¥**
- `spring.profiles.active` ë¶ˆí•„ìš” â†’ ë‹¨ì¼ íŒŒì¼ë¡œ ìš´ì˜ ê°€ëŠ¥
- ê°œë°œ/ìš´ì˜/ë¡œì»¬ ëª¨ë‘ ê°™ì€ ì„¤ì • êµ¬ì¡°ë¡œ ë™ì‘
- CI/CD ì‹œ `.env` ë˜ëŠ” GitHub Secretsë¡œ í™˜ê²½ë³€ìˆ˜ ì£¼ì…ë§Œ í•˜ë©´ ë

## .env

```text
# ì´ íŒŒì¼ì€ í‚¤ë§Œ ìˆëŠ” ê²ƒì´ ì •ìƒì…ë‹ˆë‹¤.
# ê°’ì„ ì±„ì›Œì„œ ì‚¬ìš©í•˜ì§€ë§Œ, Gitì— ì»¤ë°‹í•˜ì§€ëŠ” ë§ˆì„¸ìš”!

SPRING_DATASOURCE_URL=
SPRING_DATASOURCE_USERNAME=
SPRING_DATASOURCE_PASSWORD=

SERVER_PORT=

LOG_LEVEL_ROOT=
LOG_LEVEL_MYBOARD=
```

### êµ¬ì„± ì„¤ëª…

| í•­ëª©                     | ì„¤ëª…                                                |
|------------------------|---------------------------------------------------|
| Spring ì„¤ì •ê³¼ 1:1 ë§¤í•‘      | `application.yml`ì˜ `${}`ì™€ ì§ì ‘ ì—°ê²°ë¨                  |
| docker-composeì—ì„œ ìë™ ì¸ì‹ | `docker-compose up` ì‹¤í–‰ ì‹œ ë³„ë„ ì˜µì…˜ ì—†ì´ ìë™ ì ìš©           |
| ë¡œì»¬ ì „ìš©                  | ê°œë°œ/ìš´ì˜ ì„œë²„ì—ì„œëŠ” GitHub Secretsì„ ì‚¬ìš©í•˜ì—¬ ìƒì„±í•œ `.env` íŒŒì¼ ì‚¬ìš© |

## docker-compose.yml

```yaml
version: "3.8"

services:
  app:
    image: ghcr.io/myorg/myboard:latest
    ports:
      - "${SERVER_PORT:-8080}:8080"
    environment:
      - SPRING_DATASOURCE_URL=${SPRING_DATASOURCE_URL}
      - SPRING_DATASOURCE_USERNAME=${SPRING_DATASOURCE_USERNAME}
      - SPRING_DATASOURCE_PASSWORD=${SPRING_DATASOURCE_PASSWORD}
      - LOG_LEVEL_ROOT=${LOG_LEVEL_ROOT}
      - LOG_LEVEL_MYBOARD=${LOG_LEVEL_MYBOARD}
    networks:
      - backend-net
    depends_on:
      - db

  db:
    image: mysql:8
    ports:
      - "3306:3306"
    environment:
      MYSQL_DATABASE: myboard
      MYSQL_USER: ${SPRING_DATASOURCE_USERNAME}
      MYSQL_PASSWORD: ${SPRING_DATASOURCE_PASSWORD}
      MYSQL_ROOT_PASSWORD: rootpass
    volumes:
      - mysql-data:/var/lib/mysql
    networks:
      - backend-net

volumes:
  mysql-data:

networks:
  backend-net:
    external: true
```

- ë¡œì»¬ ê°œë°œ í™˜ê²½ê³¼ ê°œë°œ/ìš´ì˜ ì„œë²„ì—ì„œ ê³µí†µìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” **Compose ì„¤ì • íŒŒì¼**
- **`.env`ë¡œë¶€í„° í™˜ê²½ë³€ìˆ˜ë¥¼ ì£¼ì…ë°›ì•„** ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ëŠ” êµ¬ì¡°

### êµ¬ì„± ì„¤ëª…

| í•­ëª©            | ë‚´ìš©                                                               |
|---------------|------------------------------------------------------------------|
| `image`       | ìš´ì˜ì—ì„œëŠ” GHCRì— í‘¸ì‹œëœ ì´ë¯¸ì§€ ì‚¬ìš© (`docker-compose.override.yml`ì—ì„œ ë¹Œë“œë¡œ ë®ì–´ì”€) |
| `ports`       | í˜¸ìŠ¤íŠ¸ í¬íŠ¸ëŠ” `.env`ì—ì„œ ì£¼ì…, ê¸°ë³¸ê°’ì€ 8080                                   |
| `environment` | `.env`ì—ì„œ ì½ì€ í™˜ê²½ë³€ìˆ˜ë¥¼ Spring Bootì— ì „ë‹¬                                |
| `volumes`     | DB ë°ì´í„°ëŠ” `mysql-data` ë³¼ë¥¨ì— ìœ ì§€                                      |
| `networks`    | ê³µí†µ ë„¤íŠ¸ì›Œí¬ `backend-net`ì— ì—°ê²° (ì‚¬ì „ ìƒì„± í•„ìš”ğŸ”¥)                           |
| `depends_on`  | `db`ê°€ ë¨¼ì € ì‹œì‘ë˜ì–´ì•¼ `app` ì‹œì‘ë¨                                         |

### networks ì‚¬ì „ ìƒì„±ì— ëŒ€í•˜ì—¬

```yaml
networks:
  backend-net:
    external: true
```

- ì´ ì„¤ì •ì€ **`backend-net`ì´ë¼ëŠ” Docker ë„¤íŠ¸ì›Œí¬ê°€ ì‚¬ì „ì— ìƒì„±ë˜ì–´ ìˆì–´ì•¼ í•œë‹¤**ëŠ” ì˜ë¯¸
- ìë™ ìƒì„±ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì—, **ì²˜ìŒ í•œ ë²ˆì€ ìˆ˜ë™ìœ¼ë¡œ ìƒì„±í•´ì¤˜ì•¼ í•¨**

#### ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬ ìƒì„± ëª…ë ¹ì–´

```bash
docker network create backend-net
```

#### í™•ì¸

```bash
docker network ls
```

â†’ `backend-net`ì´ ë³´ì´ë©´ ìƒì„± ì™„ë£Œ

#### ì‚­ì œ ëª…ë ¹ì–´ (í•„ìš” ì‹œ)

```bash
docker network rm backend-net
```

- ë‹¨, í•´ë‹¹ ë„¤íŠ¸ì›Œí¬ì— ì—°ê²°ëœ ì»¨í…Œì´ë„ˆê°€ ìˆìœ¼ë©´ ì‚­ì œë˜ì§€ ì•ŠìŒ

#### ì™œ ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬ë¥¼ ë”°ë¡œ ìƒì„±í•˜ë‚˜ìš”?

- ì—¬ëŸ¬ **Compose í”„ë¡œì íŠ¸ë¼ë¦¬ ë„¤íŠ¸ì›Œí¬ë¥¼ ê³µìœ **í•  ìˆ˜ ìˆë„ë¡ í•˜ê¸° ìœ„í•´
- ì˜ˆ: Kafka, Redis, DB ë“± ë‹¤ë¥¸ ì„œë¹„ìŠ¤ë“¤ì´ ì„œë¡œ ë‹¤ë¥¸ compose íŒŒì¼ë¡œ ê´€ë¦¬ë˜ì–´ë„ `backend-net`ìœ¼ë¡œ í†µì‹  ê°€ëŠ¥
- `external: true` ì„¤ì •ìœ¼ë¡œ ê° í”„ë¡œì íŠ¸ê°€ ë™ì¼ ë„¤íŠ¸ì›Œí¬ì— ì°¸ì—¬

## docker-compose.override.yml

```yaml
services:
  app:
    build:
      context: .
    image: local-myboard
```

- ì´ íŒŒì¼ì€ `docker-compose up` ëª…ë ¹ ì‹¤í–‰ ì‹œ ìë™ìœ¼ë¡œ **ê¸°ë³¸ `docker-compose.yml`ì— ë³‘í•©ë˜ë©°**,
- **ìš´ì˜ ì„œë²„ì—ì„œëŠ” ì‚¬ìš©ë˜ì§€ ì•Šê³ , ë¡œì»¬ì—ì„œë§Œ ê°œë°œìë¥¼ ìœ„í•œ ì„¤ì •ì„ ë®ì–´ì“°ê¸° ìœ„í•´ ì¡´ì¬**

### êµ¬ì„± ì„¤ëª…

| í‚¤                      | ì„¤ëª…                               |
|------------------------|----------------------------------|
| `build.context: .`     | í˜„ì¬ ë””ë ‰í† ë¦¬ ê¸°ì¤€ìœ¼ë¡œ Dockerfileì„ ì‚¬ìš©í•˜ì—¬ ë¹Œë“œ |
| `image: local-myboard` | ë¹Œë“œëœ ì´ë¯¸ì§€ë¥¼ ë¡œì»¬ì—ì„œë§Œ ì‚¬ìš©í•˜ëŠ” ì´ë¦„ìœ¼ë¡œ ì§€ì •      |

- `docker-compose.yml`ì˜ `app.image: ghcr.io/...` ì„¤ì •ì€
- ë¡œì»¬ì—ì„œ `override.yml`ì˜ `build:`ë¡œ **ìë™ ë®ì–´ì“°ê¸°** ë©ë‹ˆë‹¤.

ë”°ë¼ì„œ,

```bash
docker-compose up
```

ìœ„ ëª…ë ¹ ì‹¤í–‰ ì‹œ â†’ `Dockerfile`ë¡œë¶€í„° ì´ë¯¸ì§€ë¥¼ ë¹Œë“œ â†’ `local-myboard`ë¡œ ì‹¤í–‰ë¨

#### ì¶”ê°€ì ìœ¼ë¡œ ë®ì–´ì“¸ ìˆ˜ ìˆëŠ” í•­ëª© ì˜ˆì‹œ

```yaml
services:
  app:
    environment:
      - LOG_LEVEL_ROOT=debug
    volumes:
      - .:/app  # ì½”ë“œ ë³€ê²½ ì‹œ ì‹¤ì‹œê°„ ë°˜ì˜ (ì„ íƒ ì‚¬í•­)
    ports:
      - "8080:8080"
```

> ê°œë°œ í™˜ê²½ ì „ìš© ì„¤ì •ì¸ override.yml íŒŒì¼ì„ ì‚¬ìš©í•˜ë©´ ìš´ì˜ í™˜ê²½ê³¼ ëª…í™•íˆ ë¶„ë¦¬ë©ë‹ˆë‹¤.

## .github/workflows/deploy-dev.yml

```yaml
name: ê°œë°œ ì„œë²„ì— ë°°í¬

on:
  push:
    branches: [ dev ]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
        uses: actions/checkout@v3

      - name: ì´ë¯¸ì§€ íƒœê·¸ ì„¤ì •
        id: version
        run: echo "tag=$(echo $GITHUB_SHA | cut -c1-7)" >> "$GITHUB_OUTPUT"

      - name: GHCR ë¡œê·¸ì¸
        run: echo "${{ secrets.DEV_REGISTRY_TOKEN }}" | docker login ghcr.io -u ${{ github.actor }} --password-stdin

      - name: Docker ì´ë¯¸ì§€ ë¹Œë“œ ë° í‘¸ì‹œ
        run: |
          docker build -t ghcr.io/${{ github.repository_owner }}/myboard:${{ steps.version.outputs.tag }} .
          docker push ghcr.io/${{ github.repository_owner }}/myboard:${{ steps.version.outputs.tag }}

      - name: SSH í‚¤ ì¤€ë¹„
        run: |
          echo "${{ secrets.DEV_SSH_KEY }}" | base64 -d > key.pem
          chmod 600 key.pem

      - name: Compose íŒŒì¼ ì„œë²„ë¡œ ë³µì‚¬
        run: |
          ssh -i key.pem -o StrictHostKeyChecking=no ${{ secrets.DEV_USER }}@${{ secrets.DEV_HOST }} "mkdir -p ~/myboard-backend"
          scp -i key.pem -o StrictHostKeyChecking=no docker-compose.yml docker-compose.override.yml ${{ secrets.DEV_USER }}@${{ secrets.DEV_HOST }}:~/myboard-backend

      - name: ì„œë²„ì— .env íŒŒì¼ ì‘ì„±
        run: |
          ssh -i key.pem -o StrictHostKeyChecking=no ${{ secrets.DEV_USER }}@${{ secrets.DEV_HOST }} << EOF
          echo "# .env - ê°œë°œ ì„œë²„ í™˜ê²½ ì„¤ì •" > ~/myboard-backend/.env
          echo "SPRING_DATASOURCE_URL=${{ secrets.DEV_DB_URL }}" >> ~/myboard-backend/.env
          echo "SPRING_DATASOURCE_USERNAME=${{ secrets.DEV_DB_USER }}" >> ~/myboard-backend/.env
          echo "SPRING_DATASOURCE_PASSWORD=${{ secrets.DEV_DB_PASSWORD }}" >> ~/myboard-backend/.env
          echo "SERVER_PORT=8080" >> ~/myboard-backend/.env
          echo "LOG_LEVEL_ROOT=${{ secrets.DEV_LOG_LEVEL_ROOT }}" >> ~/myboard-backend/.env
          echo "LOG_LEVEL_MYBOARD=${{ secrets.DEV_LOG_LEVEL_MYBOARD }}" >> ~/myboard-backend/.env
          echo "MYBOARD_IMAGE_TAG=${{ steps.version.outputs.tag }}" >> ~/myboard-backend/.env
          EOF

      - name: ì»¨í…Œì´ë„ˆ ì‹¤í–‰
        run: |
          ssh -i key.pem -o StrictHostKeyChecking=no ${{ secrets.DEV_USER }}@${{ secrets.DEV_HOST }} << EOF
          cd ~/myboard-backend
          docker compose --env-file .env pull
          docker compose --env-file .env up -d
          EOF
```

### êµ¬ì„± ì„¤ëª…

- `dev` ë¸Œëœì¹˜ì— í‘¸ì‹œë˜ë©´
- Docker ì´ë¯¸ì§€ë¥¼ **ë¹Œë“œ í›„ GHCR(GitHub Container Registry)ì— Push**
- `.env` íŒŒì¼ì„ GitHub Secrets ê¸°ë°˜ìœ¼ë¡œ ì„œë²„ì— ìƒì„±
- `docker-compose.yml` íŒŒì¼ì„ ì„œë²„ë¡œ ë³µì‚¬
- **SSHë¥¼ í†µí•´ ê°œë°œ ì„œë²„ì— ì ‘ì†**
- `docker compose`ë¡œ ìµœì‹  ì´ë¯¸ì§€ Pull ë° ì¬ë°°í¬

### ì‚¬ì „ ì¤€ë¹„ëœ GitHub Secrets

| ì´ë¦„                      | ì˜ˆì‹œ ê°’                               | ì„¤ëª…                                                |
|-------------------------|------------------------------------|---------------------------------------------------|
| `DEV_HOST`              | `123.45.67.89`                     | ê°œë°œ ì„œë²„ IP ë˜ëŠ” í˜¸ìŠ¤íŠ¸ëª…                                  |
| `DEV_USER`              | `ubuntu`                           | ê°œë°œ ì„œë²„ ì ‘ì† ê³„ì •                                       |
| `DEV_SSH_KEY`           | base64 ì¸ì½”ë”©ëœ ê°œì¸ í‚¤                   | `~/.ssh/id_rsa` â†’ `base64` ì²˜ë¦¬ í›„ ì €ì¥                |
| `DEV_REGISTRY_TOKEN`    | GitHub PAT                         | GHCR í‘¸ì‹œìš© Personal Access Token (`write:packages`) |
| `DEV_DB_URL`            | `jdbc:mysql://dev-db:3306/myboard` | Spring Boot datasource URL                        |
| `DEV_DB_USER`           | `devuser`                          | DB ì‚¬ìš©ìëª…                                           |
| `DEV_DB_PASSWORD`       | `devpassword`                      | DB ë¹„ë°€ë²ˆí˜¸                                           |
| `DEV_LOG_LEVEL_ROOT`    | `info`                             | ë£¨íŠ¸ ë¡œê·¸ ë ˆë²¨                                          |
| `DEV_LOG_LEVEL_MYBOARD` | `debug`                            | íŠ¹ì • íŒ¨í‚¤ì§€ ë¡œê·¸ ë ˆë²¨                                      |
