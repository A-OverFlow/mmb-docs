![image](https://github.com/user-attachments/assets/093c4ff0-e0e9-4902-9a3e-73eb8329e42c)

ì´ê²ƒì €ê²ƒ ì¡°ì‚¬í•œ.. ë½€ê¼¬êµ ì¡°ì‚¬ë³‘ë‹¨ ë²½ ì™¸ ì¡°ì‚¬ ê¸°ë¡

ë‚´ì¼ ì¡°ì‚¬ ë” í•  ì˜ˆì • ã„·ã„·


# 1. ê° ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¥¼ ë…ë¦½ì ìœ¼ë¡œ ë°°í¬í•˜ë ¤ë©´?
í•œ ì„œë¹„ìŠ¤ë§Œ ìˆ˜ì •í•´ë„, ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì— ì˜í–¥ ì—†ì´ ë°°í¬í•  ìˆ˜ ìˆì–´ì•¼ í•˜ëŠ”ê²Œ ë…ë¦½ ë°°í¬ì…ë‹ˆë„.

í•œ ì„œë¹„ìŠ¤ì— ë³€ê²½ì´ ìƒê²¼ë‹¤ê³  í•´ì„œ ë‚˜ë¨¸ì§€ ì„œë¹„ìŠ¤ê°€ í•¨ê»˜ ë¹Œë“œë˜ê±°ë‚˜ ë°°í¬ë˜ë©´ ê·¸ê±´ MSA ì² í•™ì„ ìœ„ë°˜í•˜ëŠ” ê²ƒ ã„·

- ê° ì„œë¹„ìŠ¤ëŠ” ë³„ë„ì˜ DockerFileê³¼ ë³„ë„ì˜ Docker-compose.yml íŒŒì¼ì„ ê°€ì§‘ë‹ˆë‹¤.
  - dockerfileì€ ì„œë¹„ìŠ¤ì˜ ë¹Œë“œ ë°©ì‹ê³¼ ì‹¤í–‰ í™˜ê²½ì„ ì •ì˜í•œ ê²ƒì´ê¸° ë•Œë¬¸ì— ê³µí†µëœ DockerFileì„ ì“¸ ìˆ˜ ì—…ëœ¸
  - ê³µí†µ docker-compose.yml ì— ëª¨ë“  ì„œë¹„ìŠ¤ë¥¼ ë‹¤ ë„£ìœ¼ë©´ docker-compose up í•  ë•Œ ì „ì²´ ì„œë¹„ìŠ¤ê°€ í•¨ê»˜ ì‹¤í–‰ë˜ì–´ ë²Œì„
    - íŠ¹ì • ì„œë¹„ìŠ¤ë§Œ ê°œë°œí•˜ê±°ë‚˜ ë°°í¬í•˜ë ¤ëŠ” ìƒí™©ì—ì„œëŠ” ë¶ˆí¸í•˜ê³ , ë³€ê²½ì´ ì—†ì–´ë„ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ê¹Œì§€ ë¹Œë“œ/ì¬ì‹œì‘ ë  ìˆ˜ ìˆìŒ
      
- ê° ì„œë¹„ìŠ¤ ë””ë ‰í† ë¦¬ì—ì„œ ê°œë³„ì ìœ¼ë¡œ ë‹¤ìŒ ëª…ë ¹ìœ¼ë¡œ ë°°í¬í•©ë‹ˆë‹¤.

  ```bash
  # service-a ë§Œ ê°œë³„ ë¹Œë“œë˜ê³  ì‹¤í–‰í•˜ëŠ” ëª…ë ¹ì–´
  docker-compose -f service-a/docker-compose.yml up -d --build
  ```

- CI/CDì—ì„œëŠ” Git ë¨¸ì§€ íŠ¸ë¦¬ê±°ë¥¼ í†µí•´ íŠ¹ì • ì„œë¹„ìŠ¤ë§Œ ë¹Œë“œ & ë°°í¬ í•  ìˆ˜ ìˆê²Œ ì‘ì—…í•©ë‹ˆë‹¤.


# 2. ë¡œì»¬ ê°œë°œ ë°©ë²•
## 2-1. ë¡œì»¬ì—ì„  ì–´ë–»ê²Œ?
ì½”ë“œ ìˆ˜ì •, ì¦‰ì‹œ ì¬ì‹¤í–‰, ë¸Œë ˆì´í¬í¬ì¸íŠ¸ ë””ë²„ê¹…, ë¡œê·¸ ì¶”ì ì´ ì‰½ë‹¤ë³´ë‹ˆ IntelliJ(í”„ë¡œì„¸ìŠ¤)ë¡œ ì‹¤í–‰í•˜ëŠ” ê²Œ ê°œë°œì—” í¸ë¦¬í•˜ë‹¤ í•©ë‹ˆë‹¤.

âœ… MSA ê°œë°œì˜ ì¼ë°˜ì ì¸ íë¦„ (ì‹¤ë¬´ ê¸°ì¤€)

ğŸ’» 1. ê°œë°œìëŠ” ë³¸ì¸ ì„œë¹„ìŠ¤ë§Œ ì§ì ‘ ì‹¤í–‰ (IntelliJì—ì„œ í”„ë¡œì„¸ìŠ¤ë¡œ)
- ë¹ ë¥¸ í”¼ë“œë°±, ë””ë²„ê¹… ìš©ì´
- ë³€ê²½ì´ ë§ì€ í•µì‹¬ ë¡œì§ ê°œë°œì— ì§‘ì¤‘

ğŸ§± 2. ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì™€ ì¸í”„ë¼ëŠ” docker-composeë¡œ ë„ì›€
- ê³µí†µ ë¦¬ì†ŒìŠ¤(Kafka, Redis, DB ë“±)ëŠ” í•­ìƒ ì»¨í…Œì´ë„ˆë¡œ
- ë‹¤ë¥¸ ì„œë¹„ìŠ¤ë“¤ë„ ë„ì»¤ ì´ë¯¸ì§€ë¡œ ì‹¤í–‰ (ìš´ì˜ í™˜ê²½ê³¼ ìœ ì‚¬)

ğŸ§ª 3. ì „ì²´ ì„œë¹„ìŠ¤ í†µí•© í…ŒìŠ¤íŠ¸ê°€ í•„ìš”í•  ë• ì „ì²´ ì»¨í…Œì´ë„ˆë¡œ ì‹¤í–‰
- docker-compose -f all-in-one.yml up ê°™ì€ ì‹ìœ¼ë¡œ ì „ì²´ ì‹¤í–‰
- ì‹¤ì œ ìš”ì²­ íë¦„, ì—°ë™ ë¡œì§, ì™¸ë¶€ API í˜¸ì¶œ ë“± ì ê²€

ë”°ë¼ì„œ ì•„ë˜ì˜ ì›Œí¬í”Œë¡œìš°ë¥¼ ê°€ì ¸ê°€ëŠ”ê²Œ ì–´ë–¨ì§€.
```
# 1. ê³µí†µ ë¦¬ì†ŒìŠ¤ ì‹¤í–‰
docker-compose -f infra/docker-compose.yml up -d

# 2. ì„ íƒ) ë‹¤ë¥¸ ì„œë¹„ìŠ¤ ë„ì»¤ë¡œ ì‹¤í–‰
docker-compose -f service-b/docker-compose.yml up -d
docker-compose -f service-c/docker-compose.yml up -d


# 3. IntelliJ ì—ì„œ service-a ì§ì ‘ ì‹¤í–‰
```

ì „ì²´ ë„ìš°ê¸°
```
docker-compose \
  -f docker-compose.common.yml \
  -f service-a/docker-compose.yml \
  -f service-b/docker-compose.yml \
  -f service-c/docker-compose.yml \
  up -d

```


**ê·¸ëŸ¼ì—ë„ ë¶ˆêµ¬í•˜ê³ , ì»¨í…Œì´ë„ˆë¡œë„ ì‹¤í–‰í•  ë•ŒëŠ”?**
1. ë¡œì»¬ í™˜ê²½ê³¼ ë°°í¬ í™˜ê²½ì´ ë¹„ìŠ·í•œì§€ í™•ì¸í•˜ê³  ì‹¶ì„ ë•Œ
2. í†µí•© í…ŒìŠ¤íŠ¸ ë˜ëŠ” CI í™˜ê²½ê³¼ ë™ì¼í•˜ê²Œ í…ŒìŠ¤íŠ¸í•˜ê³  ì‹¶ì„ ë•Œ

ìœ„ ìƒí™©ì„ ì œì™¸í•˜ê³ ëŠ” í‰ìƒì‹œì—” IntelliJ ì‹¤í–‰ì„ ê¸°ë³¸ìœ¼ë¡œ ê°€ì ¸ê°€ìŸˆ

### ìš”ì•½
| í•­ëª© | ì¶”ì²œ ë°©ì‹ |
|------|------------|
| ë³¸ì¸ì´ ê°œë°œí•˜ëŠ” ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ | IntelliJ ë“±ì—ì„œ í”„ë¡œì„¸ìŠ¤ë¡œ ì‹¤í–‰ |
| ì˜ì¡´ ì„œë¹„ìŠ¤(DB, Kafka ë“±) | docker-composeë¡œ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ |
| ì „ì²´ ì„œë¹„ìŠ¤ í†µí•© í…ŒìŠ¤íŠ¸ | ì „ì²´ë¥¼ ì»¨í…Œì´ë„ˆë¡œ ì‹¤í–‰ |

## 2-2. ì „ì²´ ì„œë¹„ìŠ¤ ë„ìš°ê¸°
ë³¸ì¸ì´ ê°œë°œí•˜ëŠ” ë§ˆì´í¬ë¡œ ì„œë¹„ìŠ¤ ì´ì™¸ì—ë„ ì „ì²´ ì‹œìŠ¤í…œ íë¦„ì„ í™•ì¸í•˜ê³  ì‹¶ì„ ê²½ìš°...


## 2-3. IntelliJ ì—ì„œ Docker ì‚¬ìš© ë°©ë²•

!ë„ì»¤ ì„¤ì¹˜ ë˜ì–´ ìˆì–´ì•¼ í•¨

step1. Settings > Build, Execution, Deployment > Docker

step2. + ë²„íŠ¼ì„ ëˆŒëŸ¬ Docker for Mac, Docker for Windows, TCP Socket ì¤‘ í™˜ê²½ì— ë§ê²Œ ì„¤ì •

step3. ì„¤ì • í›„ Services íƒ­ì—ì„œ ì»¨í…Œì´ë„ˆ ìƒíƒœ, ë¡œê·¸ ì‹¤í–‰ ê´€ë¦¬ ê°€ëŠ¥

step4. ê° ì„œë¹„ìŠ¤ì˜ Dockerfileì´ë‚˜ docker-compose.yml ì„ ìš°í´ë¦­í•˜ì—¬ ì‹¤í–‰ ê°€ëŠ¥


# 3. ê° ì„œë¹„ìŠ¤ë³„ docker-compose.yml ì´ ê°–ì¶°ì•¼í•  ë‚´ìš©
```yaml
version: '3.8'

services:
  service-a:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8080:8080"
    env_file:
      - .env
    networks:
      - shared-network

```
ìµœì†Œ êµ¬ì„± : 
- build : ì„œë¹„ìŠ¤ ë””ë ‰í† ë¦¬ì™€ Dockerfile ê²½ë¡œ
- ports : ì™¸ë¶€ í¬íŠ¸ ë§¤í•‘
- env_file : í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬
- networks : ë„¤íŠ¸ì›Œí¬ ì„¤ì •


# 4. ê³µí†µ docker-compose.yml?
ì „ì²´ msa ì•„í‚¤í…ì²˜ë¥¼ êµ¬ì„±í•˜ê¸° ìœ„í•´ ê°œë³„ ì„œë¹„ìŠ¤ê°€ ê°€ì§€ëŠ” docker compose í•­ëª© ì™¸ì— í•„ìš”í•œ í•­ëª©ì„ í¬í•¨í•©ë‹ˆë‹¤.

ë””ë ‰í† ë¦¬ êµ¬ì¡°
```bash
/msa-root/
  docker-compose.yml         <-- ê³µí†µ ë¦¬ì†ŒìŠ¤ ì •ì˜
  /service-a/
    docker-compose.yml
  /service-b/
    docker-compose.yml

```

MySql, Kafka, Redis ê°™ì€ ì˜ì¡´ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•´ ì •ì˜í•©ë‹ˆë‹¤.
| ì´ìœ  | ì„¤ëª… |
|------|------|
| âŒ ë¡œì»¬ ì„¤ì¹˜ ë¶ˆí¸ | ê°ê° ë²„ì „ë„ ë‹¤ë¥´ê³ , ì„¤ì •ë„ ë‹¤ë¥´ê³  ê·€ì°®ìŒ |
| âœ… ì»¨í…Œì´ë„ˆë¡œ í†µì¼ | ê³µí†µ docker-compose.ymlë¡œ í•œë²ˆì— ì‹¤í–‰ ê°€ëŠ¥ |
| ğŸ§ª í…ŒìŠ¤íŠ¸ í™˜ê²½ í†µì¼ | íŒ€ì› ëª¨ë‘ ê°™ì€ í™˜ê²½ì—ì„œ ê°œë°œ ê°€ëŠ¥ |


```yaml
version: '3.8'

services:
  mmb-redis:
    image:  redis:latest
    ports:
      - 6379:6379

networks:
  shared-network:

```
ê° ì„œë¹„ìŠ¤ëŠ” external_networks ì„¤ì •ìœ¼ë¡œ ì´ ë„¤íŠ¸ì›Œí¬ì— ì°¸ì—¬




# 5. í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬ë²•
í•˜ë‚˜ì˜ í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ ë˜ëŠ” ì„¤ì •ì„ ê³µìœ í•´ì„œ ë‘˜ë‹¤ ê°™ì€ ì„¤ì •ì„ ì“°ê²Œ ë§Œë“¤ì–´ì•¼ í•¨
1. ë¡œì»¬ ë ˆí¬ì— ìˆëŠ” docker-compose.ymlì— ì•„ë˜ì²˜ëŸ¼ .env íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ê²Œ ì„¤ì •
```yaml
env_file:
  - .env
```
2. IntelliJì˜ Run/Debug Configurationsì— .envì™€ í™˜ê²½ë³€ìˆ˜ë¥¼ ë™ì¼í•˜ê²Œ ì…ë ¥
