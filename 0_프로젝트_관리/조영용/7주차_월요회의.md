# 이거 MSA 스터디 맞습니까?

## MSA가 뭔데?

마이크로서비스 아키텍처(Microservices Architecture)

하나의 애플리케이션을 여러 개의 작은 독립적인 서비스로 나누어 개발하고 운영하는 소프트웨어 아키텍처 스타일.

각 서비스를 **독립적으로 배포, 확장, 유지보수가 가능**하도록 설계.

## 지금 우리가 하고 있는 것은?

- 도메인 별로 서비스를 나누고 (Auth, Member, Question)
- DB를 분리하고
- REST API로 통신하며
- 독립적인 배포가 가능한

애플리케이션을 만들고 있다!

## 쿠버네티스 안해요? 쿠버네티스?!

MSA는 아키텍처(구조)이지 도구가 아닙니다.

쿠버네티스를 쓴다. 도커 컴포즈 쓴다. 그러니까 MSA (x)

중요한 것은 **각 서비스가 분리되고, 독립적으로 배포되고, 서로 통신하는 구조**를 만들고 개발하는 것.

# 현황 파악

## 우리가 지금까지 한 것

- [x] 도메인별로 서비스 나누기
- [x] 각 서비스 마다 DB 가지기
- [x] 단일 진입점 만들기 (Nginx, API Gateway)
- [x] Front End / Back End 분리
- [x] 모니터링 시스템 구축

## 부족한 부분들

- dev 브랜치에 push 이벤트 발생했을 때 자동 배포
    - 서비스가 컨데이터 단위로 개발 서버에 배포되지 못함
    - 현재는 전체 서비스를 하나의 yml로 관리하고 있음
- '애플리케이션 - 환경 변수 - 도커(컨테이너) - 도커 컴포즈' 간의 상호작용 이해
    - local, dev, prod 별로 환경 변수 파일이 왜 필요한 지
    - 애플리케이션이 실행될 때 환경 변수를 어떻게 동적으로 설정하는 지
    - 왜 도커(컨테이너)를 사용해야 하는 지
    - Dockerfile 로 빌드한다는 것은 무엇인가?
    - 컨테이너를 실행할 때 환경 변수는 어떻게 설정하는 가?
    - 도커 컴포즈를 사용하는 이유는?

# 나의 실수는 무엇인가

## 내가 생각한 단계

1. 개발 및 환경 구성
2. 개발 완료 -> 개발 환경 배포
3. 개발 환경 -> 운영 환경
4. 완.벽.

## 실제 단계

1. 개발 및 환경 구성
    1. REST API 문서가 필요한 이유의 이해
    2. 문서 작성
    3. 스프링 프레임워크의 이해
    4. 레이어드 아키텍처의 이해
    5. 개발
    6. 테스트 코드 작성 방법의 이해
    7. 테스트 코드 작성
    8. 로컬/개발/운영 환경 설정 및 이해
    9. application.yml 작성
    10. 자동 배포의 이해
    11. Dockerfile 작성
    12. docker-compose.yml 파일 작성
2. 개발 완료 -> 개발 환경 배포
    1. EC2 환경 설정 (패키지 설치)
    2. DB 컨테이너 설정
    3. 깃허브 Action 설정
    4. 도커 이미지 허브에 업로드
    5. 도커 이미지 다운로드 테스트
    6. 컨테이너 실행 테스트
    7. 환경 변수 설정 테스트
    8. 서비스 별 에러 로그 확인
    9. 에러 공유
    10. 파트간 환경 변수 설정 협의
    11. ...
3. ?????????????????????
4. 절.망.

# TO DO LIST

> 현재 구성을 완벽하게 이해하고 구성원 간의 커뮤니케이션에 집중하자

> 이번주는 자료 조사 및 문서 작성 위주로 진행

## 비지니스 파트

- ✅기술 조사 및 문서 작성
    - 스프링 부트 애플리케이션의 환경 변수 설정 방법
        - application.yml 생성 및 관리 방법
        - application.yml 파일이 동작하는 방법
        - 비지니스 파트 서비스에서 환경 별로 다르게 설정해야 하는 변수들
    - Docker와 Docker Compose
        - 컨테이너를 사용 하는 이유
        - 도커 컴포즈를 사용하는 이유
        - 자동 배포를 해야하는 이유
        - application.yml, docker-compose.yml 파일에 환경 변수 설정하는 방법과 해야하는 이유
- 로컬 환경 구성
    - 🔥**프로세스 실행 환경 구성 (컨테이너 x)**
    - application.yml 작성
    - application-local.yml 작성
    - 특별한 설정 없이 바로 실행할 수 있도록
    - 환경 변수 주입 x
- 개발 환경 구성
    - 🔥**컨테이너 실행 환경 구성**
    - application-dev.yml 작성
    - Dockerfile 작성
    - docker-compose.yml 작성
    - .env 작성
- 운영 환경 구성 (x)
    - 현시점에서 고려하지 않음

## 인프라 파트

- ✅기술 조사 및 문서 작성
    - 브랜치에 push 이벤트가 발생한 이후 개발서버 배포까지 프로세스 설명
        - 어떻게 push 이벤트를 감지?
        - 이벤트를 감지한 이후의 동작은 어디에 어떻게 작성?
        - 환경변수 설정은 언제 어디서 이루어지나?
        - 빌드한 파일은 어디로 언제 업로드 되며, 언제 다운로드 받아지나?
        - 다운로드 받은 artifact(산출물)은 어떻게 확인할 수 있나?
        - 정상 실행은 어떻게 확인할 수 있으며
        - 로그는 어떻게 추적하고
        - 재실행은 어떤 과정으로 해야하나
    - 비지니스 파트(서비스 개발자)를 위한 파일 작성 가이드
        - 프로젝트에 추가되어야 하는 파일 제안 및 작성 가이드
            - .env
            - Dockerfile
            - docker-compose.yml
        - 환경 변수는 어떻게 관리할 것인가
            - .env 작성?
            - 깃허브 시크릿?
            - 어떤 변수는 파일에 작성하고 어떤 변수는 시크릿에 작성?
        - 변수가 아니라 파일이라면?
            - https 인증서
- 자동 배포 환경 구성
    - [x] push 이벤트 감지
    - [x] jar 빌드 및 도커 빌드
    - [x] 허브 업로드
    - [ ] 개별 서비스 배포

## 파트간 협업시간 협의 (제발 소통)

- 요구 및 질문 -> h시간 or d일 이후 -> 피드백 -> h시간 or d일 이후 -> 피드백 -> 일주일 끝
- Zep에서 모이자
  - 시간을 따로 내란 뜻이 아닙니다
  - 어차피 작업할 시간에 같이 모여서 하자는 겁니다
  - 서로 소통이 필요없는 작업이더라도 누군가는 나에게 질문이 있을 지 모르니까
  - 일단 zep에 접속한채로 작업하자
- 매일 접속 안해도 됩니다 일단 가능한 시간, 대략적인 시간을 정해서 온라인에서 만날 수 있는 확률을 최대한 올려보자는 뜻
- 접속 유지시간 정해서 최대한 그 시간에는 접속 유지하는 것으로!

## item 재설정

- 문서 작성 및 자료조사 item 생성
- 이터레이션 재설정